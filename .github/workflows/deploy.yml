# .github/workflows/deploy.yml
name: Deploy 🚀 Clima to Google Cloud Run (☁🏃)
on:
  push:
    branches:
      - TEST-main # TODO: If it works, revert to "main".
jobs:
  deploy:
    name: Deploying 🚀 Clima
    runs-on: ubuntu-latest
    if: "contains(github.event.head_commit.message, 'bump version')"
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Google Auth
        id: auth
        uses: 'google-github-actions/auth@v0'
        with:
          credentials_json: '${{ secrets.GCP_CREDENTIALS }}'

      - name: Deploy (🚀)
        uses: google-github-actions/deploy-cloudrun@v1
        with:
          service: clima
          source: ./
          region: us-central1
          credentials: ${{ secrets.GCP_SA_KEY_JSON }}
          project_id: TEST-clima-316917 # TODO: If it works, revert.